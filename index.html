<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OMEGA DATABASE</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
margin:0;
font-family:Segoe UI, sans-serif;
background:radial-gradient(circle at top,#0f2027,#203a43,#0a0f14);
color:#e0f7ff;
}

.hidden{display:none;}

.container{padding:20px;}

h1,h2{
letter-spacing:2px;
}

input,select,textarea{
width:100%;
padding:8px;
margin:4px 0;
border-radius:8px;
border:none;
background:#1b2b34;
color:white;
}

button{
padding:8px 12px;
margin:4px 2px;
border:none;
border-radius:8px;
cursor:pointer;
background:#00c3ff;
color:white;
font-weight:bold;
transition:0.3s;
}

button:hover{
background:#007ad9;
transform:scale(1.05);
}

.card{
background:#14212b;
margin:15px 0;
padding:15px;
border-radius:15px;
position:relative;
box-shadow:0 0 20px rgba(0,200,255,0.2);
animation:fadeIn 0.5s ease;
}

@keyframes fadeIn{
from{opacity:0;transform:translateY(10px);}
to{opacity:1;transform:translateY(0);}
}

.top-secret{
position:absolute;
top:10px;
right:10px;
font-size:11px;
color:red;
border:1px solid red;
padding:3px 6px;
transform:rotate(15deg);
font-weight:bold;
}

.images img{
max-width:80px;
margin:5px;
border-radius:8px;
}

.filters{
display:flex;
flex-wrap:wrap;
gap:10px;
margin-bottom:10px;
}

.role-badge{
position:absolute;
top:10px;
left:10px;
font-size:12px;
background:#007ad9;
padding:3px 6px;
border-radius:6px;
}
</style>
</head>
<body>

<div class="container" id="authPage">
<h1>OMEGA ACCESS</h1>
<input id="authUser" placeholder="Usuario">
<input id="authPass" type="password" placeholder="Contraseña">
<select id="authRole">
<option value="Agente">Agente</option>
<option value="Director">Director</option>
</select>
<button onclick="register()">Registrarse</button>
<button onclick="login()">Ingresar</button>
</div>

<div class="container hidden" id="mainPage">
<h1>BASE DE DATOS META HUMANOS</h1>
<button onclick="logout()">Cerrar sesión</button>

<h2>Nuevo Expediente</h2>
<form id="metaForm">
<input placeholder="Número de archivo" required>
<input placeholder="Nombre completo" required>
<input placeholder="Especie">
<input placeholder="Subespecie">
<input type="number" placeholder="Edad">
<input type="date">
<input type="number" placeholder="Peso">
<input type="number" placeholder="Altura">
<input placeholder="Sexo">
<input placeholder="Padres">
<input placeholder="Hermanos">
<input placeholder="Hijos">
<input placeholder="Estado civil">
<input placeholder="Ocupación">
<input placeholder="Ciudad - País de nacimiento">
<textarea placeholder="Poderes"></textarea>

<select>
<option value="">Nivel de poder</option>
<option>Epsilon</option>
<option>Omicron</option>
<option>Omega</option>
<option>Alfa</option>
<option>Delta</option>
</select>

<select>
<option value="">Nivel de peligro</option>
<option>Gamma</option>
<option>Beta</option>
</select>

<select>
<option value="">Nivel de inteligencia</option>
<option>Bajo</option>
<option>Normal</option>
<option>Alto</option>
</select>

<select>
<option value="">MBTI</option>
<option>INTJ</option><option>INTP</option><option>ENTJ</option><option>ENTP</option>
<option>INFJ</option><option>INFP</option><option>ENFJ</option><option>ENFP</option>
<option>ISTJ</option><option>ISFJ</option><option>ESTJ</option><option>ESFJ</option>
<option>ISTP</option><option>ISFP</option><option>ESTP</option><option>ESFP</option>
</select>

<textarea placeholder="Dato curioso"></textarea>
<textarea placeholder="Nota del director"></textarea>
<input type="file" multiple accept="image/*">
<button type="submit">Guardar</button>
</form>

<h2>Filtros</h2>
<div class="filters">
<input id="searchArchivo" placeholder="Buscar por Nº archivo" oninput="render()">
<select id="filterPower" onchange="render()">
<option value="">Poder</option>
<option>Epsilon</option><option>Omicron</option><option>Omega</option><option>Alfa</option><option>Delta</option>
</select>
<select id="filterDanger" onchange="render()">
<option value="">Peligro</option>
<option>Gamma</option><option>Beta</option>
</select>
<select id="filterIntel" onchange="render()">
<option value="">Inteligencia</option>
<option>Bajo</option><option>Normal</option><option>Alto</option>
</select>
</div>

<h2>Expedientes</h2>
<div id="records"></div>
</div>

<script>
let users = JSON.parse(localStorage.getItem("omegaUsers")) || [];
let records = JSON.parse(localStorage.getItem("omegaRecords")) || [];
let currentUser = null;

function register(){
const user = authUser.value;
const pass = authPass.value;
const role = authRole.value;
if(user && pass){
users.push({user,pass,role});
localStorage.setItem("omegaUsers",JSON.stringify(users));
alert("Registrado.");
}
}

function login(){
const user = authUser.value;
const pass = authPass.value;
const found = users.find(u=>u.user===user && u.pass===pass);
if(found){
currentUser = found;
authPage.classList.add("hidden");
mainPage.classList.remove("hidden");
}else alert("Credenciales incorrectas");
}

function logout(){
currentUser=null;
mainPage.classList.add("hidden");
authPage.classList.remove("hidden");
}

metaForm.addEventListener("submit",function(e){
e.preventDefault();
const inputs = this.querySelectorAll("input,select,textarea");
const files = inputs[inputs.length-2].files;
let imgs=[];
for(let f of files){
const reader=new FileReader();
reader.onload=()=>{imgs.push(reader.result);if(imgs.length===files.length)save(inputs,imgs)};
reader.readAsDataURL(f);
}
if(files.length===0) save(inputs,[]);
});

function save(inputs,imgs){
const data={
archivo:inputs[0].value,
nombre:inputs[1].value,
poderNivel:inputs[16].value,
peligro:inputs[17].value,
inteligencia:inputs[18].value,
mbti:inputs[19].value,
poderes:inputs[15].value,
images:imgs
};
records.push(data);
localStorage.setItem("omegaRecords",JSON.stringify(records));
metaForm.reset();
render();
}

function deleteRecord(i){
if(currentUser.role==="Director"){
records.splice(i,1);
localStorage.setItem("omegaRecords",JSON.stringify(records));
render();
}else alert("Solo el Director puede eliminar.");
}

function exportPDF(r){
const { jsPDF } = window.jspdf;
const doc = new jsPDF();
doc.text("EXPEDIENTE META HUMANO",10,10);
doc.text("Archivo: "+r.archivo,10,20);
doc.text("Nombre: "+r.nombre,10,30);
doc.text("Poderes: "+r.poderes,10,40);
doc.save(r.archivo+".pdf");
}

function render(){
recordsDiv=document.getElementById("records");
recordsDiv.innerHTML="";
let search=searchArchivo.value.toLowerCase();
let power=filterPower.value;
let danger=filterDanger.value;
let intel=filterIntel.value;

records.filter(r=>
(!search||r.archivo.toLowerCase().includes(search)) &&
(!power||r.poderNivel===power) &&
(!danger||r.peligro===danger) &&
(!intel||r.inteligencia===intel)
).forEach((r,i)=>{
let div=document.createElement("div");
div.className="card";
div.innerHTML=`
<div class="role-badge">${currentUser.role}</div>
<div class="top-secret">TOP SECRET</div>
<h3>${r.archivo} - ${r.nombre}</h3>
<p><strong>Poderes:</strong> ${r.poderes}</p>
<p><strong>Nivel:</strong> ${r.poderNivel} | ${r.peligro} | ${r.inteligencia}</p>
<p><strong>MBTI:</strong> ${r.mbti}</p>
<div class="images">${r.images.map(img=>`<img src="${img}">`).join("")}</div>
<button onclick='exportPDF(${JSON.stringify(r)})'>PDF</button>
<button onclick='deleteRecord(${i})'>Eliminar</button>
`;
recordsDiv.appendChild(div);
});
}

render();
</script>
</body>
</html>
